<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Delete User</title>
    
   <style>
        /* Basic Reset */
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; }
        
        /* Layout */
        .dashboard_wrapper { display: flex; height: 100vh; }
        
        /* Sidebar Styling */
        .side-menu { width: 250px; background-color: #192a56; color: white; padding: 20px; display: flex; flex-direction: column; }
        .side-menu h3 { margin-bottom: 30px; text-align: center; border-bottom: 1px solid #34495e; padding-bottom: 20px; }
        .side-menu a { color: #bdc3c7; text-decoration: none; padding: 15px; margin-bottom: 10px; border-radius: 4px; transition: 0.3s; }
        .side-menu a:hover, .side-menu a.active { background-color: #192a56; color: white; }
        
        /* Main Content Styling */
        #main_content { flex: 1; padding: 40px; display: flex; justify-content: center; align-items: flex-start; }
        #search_delete_container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        
        /* Form Elements */
        h2 { margin-top: 0; color: #333; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        
        /* Buttons */
        .btn-danger { background-color: #e74c3c; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%; transition: background 0.3s; }
        .btn-danger:hover { background-color: #c0392b; }
        
        /* Status Messages */
        #status_message { margin-top: 20px; padding: 10px; border-radius: 4px; display: none; text-align: center; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

   <div class="dashboard_wrapper">        
        <nav class="side-menu">
            <h3>Admin Panel</h3>
            <a href="delete_user.html" id="admin_delete" class="active">Delete User</a>
            <a href="manage_reviews.html" id="admin_reviews">Manage Reviews</a>
            <a href="statistics.html" id="admin_statistics">Show Statistics</a>
        </nav>

        <main id="main_content">
            <div id="search_delete_container">
                <h2>Delete User Account</h2>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 20px;">
                    Warning: This action cannot be undone. Please ensure you have the correct Username.
                </p>
                
                <div class="input-group">
                    <label for="delete_search">Username</label>
                    <input type="text" id="delete_search" placeholder="e.g. johndoe123">
                </div>
                
                <button id="delete_btn" class="btn-danger">Permanently Delete User</button>
                
                <div id="status_message"></div>
            </div>
        </main>
    </div>

    <script>
        document.getElementById('delete_btn').addEventListener('click', function() {
            const inputField = document.getElementById('delete_search');
            const userIdentifier = inputField.value.trim();

            // 1. Validation: Check if input is empty
            if (!userIdentifier) {
                showStatus('Please enter a Username.', 'error');
                return;
            }

            // 2. Safety Confirmation
            const isConfirmed = confirm(`Are you absolutely sure you want to delete the user: "${userIdentifier}"?\n\nThis action cannot be undone.`);

            if (isConfirmed) {
                // 3. ACTUAL API Call
                performDeleteRequest(userIdentifier);
            }
        });

        async function performDeleteRequest(username) {
            const btn = document.getElementById('delete_btn');
            const inputField = document.getElementById('delete_search');
            
            // UI State: Loading
            btn.textContent = "Deleting...";
            btn.disabled = true;

            try {
                // Fetch Request to your Node.js backend
                const response = await fetch(`/users/${username}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                // Check Response Status
                if (response.ok) {
                    // Success (HTTP 200)
                    showStatus(data.message || `Success: User "${username}" has been deleted.`, 'success');
                    inputField.value = ''; // Clear input
                } else {
                    // Error (HTTP 404 or 500)
                    showStatus(data.error || 'An error occurred while deleting.', 'error');
                }

            } catch (error) {
                // Network Errors
                console.error('Fetch error:', error);
                showStatus('Network error. Could not connect to server.', 'error');
            } finally {
                // Reset Button
                btn.textContent = "Permanently Delete User";
                btn.disabled = false;
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status_message');
            statusDiv.textContent = message;
            statusDiv.className = type; // Apply .success or .error class
            statusDiv.style.display = 'block';
        }
    </script>
</body>
</html>